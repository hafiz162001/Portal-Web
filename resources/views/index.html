@extends('layouts.admin-lte.main')
@section('style')
    <style>
        .title-card {
            font-style: normal;
            font-weight: 500;
            font-size: 16px;
            line-height: 20px;
        }

        .container-ritz {
            position: relative;
            border-radius: 18px;
            box-shadow: 0 0 0 2px black;
            margin-top: 50px;
            margin-bottom: 50px;
            padding-bottom: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* tb */

        .ritz .waffle a {
            color: inherit;
        }

        .ritz .waffle .s3 {
            border: 1px SOLID #000000;
            background-color: #b6d7a8;
            text-align: center;
            color: #000000;
            font-family: 'Arial';
            font-size: 10pt;
            vertical-align: middle;
            white-space: nowrap;
            direction: ltr;
            padding: 2px 3px 2px 3px;
        }

        .ritz .waffle .s2 {
            background-color: #ffffff;
            text-align: center;
            text-decoration: underline;
            -webkit-text-decoration-skip: none;
            text-decoration-skip-ink: none;
            color: #1155cc;
            font-family: 'arial';
            font-size: 10pt;
            vertical-align: middle;
            white-space: nowrap;
            direction: ltr;
            padding: 2px 3px 2px 3px;
        }

        .ritz .waffle .s0 {
            background-color: #ffffff;
            text-align: center;
            color: #000000;
            font-family: 'Arial';
            font-size: 10pt;
            vertical-align: middle;
            white-space: nowrap;
            direction: ltr;
            padding: 2px 3px 2px 3px;
        }

        .ritz .waffle .s1 {
            background-color: #ffffff;
            text-align: center;
            color: #000000;
            font-family: 'Arial';
            font-size: 10pt;
            vertical-align: middle;
            white-space: nowrap;
            direction: ltr;
            padding: 2px 3px 2px 3px;
        }
    </style>
@endsection
@section('content')
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-9">
                        <div class="card">
                            <div class="card-header">
                                <div class="row justify-content-between">
                                    <div class="col-auto align-self-center">
                                        <span class="title-card">Group Heatmap</span>
                                    </div>

                                </div>
                            </div>

                            <div class="card-body">
                                <div class="container-ritz">
                                    <div class="ritz grid-container" dir="ltr">
                                        <div class="tb_plate"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                <div class="row justify-content-between">
                                    <div class="col-auto align-self-center">
                                        <span class="title-card">Total Visitor Chart</span>
                                    </div>
                                    {{-- <div class="col-auto align-self-center">
                                        <a href="">View Detail</a>
                                    </div> --}}
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="font-weight-bold">Information</p>
                                <p>AREA<span>   : ACEH</span></p>
                                <p>BUS<span>    : BUS 2</span></p>
                                <p>ARIVED TIME<span>    : 14.52</span></p>
                                <p>KONTAK<span> : 0862532635</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
@endsection
@section('javascript')
<script>
    const refreshTable = () => {
        $(".tb_plate").html(`
            <table class="waffle" cellspacing="0" cellpadding="0">
                <tbody>
                    <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px">
                    <td class="s0"></td>
                    <td class="s0" dir="ltr" colspan="3">Banten</td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px" id="banten_tr">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s2" dir="ltr"><a target="_blank" href="https://emojipedia.org/large-red-circle/">ðŸ”´</a></td>
                    <td class="s0" id="banten_td_1"></td>
                    <td class="s0" id="banten_td_2"></td>
                    <td class="s0" id="banten_td_3"></td>
                    <td class="s0" id="banten_td_4"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0" dir="ltr" colspan="3">Jawa Barat</td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td></td>
                    <td></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px" id="jabar_tr">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s2" dir="ltr"><a target="_blank" href="https://emojipedia.org/large-red-circle/">ðŸ”´</a></td>
                    <td class="s0" id="jabar_td_1"></td>
                    <td class="s0" id="jabar_td_2"></td>
                    <td class="s0" id="jabar_td_3"></td>
                    <td class="s0" id="jabar_td_4"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px">
                    <td class="s0"></td>
                    <td class="s0" dir="ltr" colspan="3">Kalimantan Barat</td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px" id="kalbar_tr">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s2" dir="ltr"><a target="_blank" href="https://emojipedia.org/large-red-circle/">ðŸ”´</a></td>
                    <td class="s0" id="kalbar_td_1"></td>
                    <td class="s0" id="kalbar_td_2"></td>
                    <td class="s0" id="kalbar_td_3"></td>
                    <td class="s0" id="kalbar_td_4"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0" dir="ltr" colspan="3">Jawa Tengah</td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px" id="jateng_tr">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s2" dir="ltr"><a target="_blank" href="https://emojipedia.org/large-red-circle/">ðŸ”´</a></td>
                    <td class="s0" id="jateng_td_1"></td>
                    <td class="s0" id="jateng_td_2"></td>
                    <td class="s0" id="jateng_td_3"></td>
                    <td class="s0" id="jateng_td_4"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px">
                    <td class="s0"></td>
                    <td class="s0" dir="ltr" colspan="3">Sulawesi Selatan</td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px" id="sulsel_tr">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s2" dir="ltr"><a target="_blank" href="https://emojipedia.org/large-red-circle/">ðŸ”´</a></td>
                    <td class="s0" id="sulsel_td_1"></td>
                    <td class="s0" id="sulsel_td_2"></td>
                    <td class="s0" id="sulsel_td_3"></td>
                    <td class="s0" id="sulsel_td_4"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0" dir="ltr" colspan="3">Jawa TImur</td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                </tr>
                <tr style="height: 32px" id="jatim_tr">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s2" dir="ltr"><a target="_blank" href="https://emojipedia.org/large-red-circle/">ðŸ”´</a></td>
                    <td class="s0" id="jatim_td_1"></td>
                    <td class="s0" id="jatim_td_2"></td>
                    <td class="s0" id="jatim_td_3"></td>
                    <td class="s0" id="jatim_td_4"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 29px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0" dir="ltr" colspan="3">Bali</td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px" id="bali_tr">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s2" dir="ltr"><a target="_blank" href="https://emojipedia.org/large-red-circle/">ðŸ”´</a></td>
                    <td class="s0" id="bali_td_1"></td>
                    <td class="s0" id="bali_td_2"></td>
                    <td class="s0" id="bali_td_3"></td>
                    <td class="s0" id="bali_td_4"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 20px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0" dir="ltr" colspan="3">Papua</td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s1"></td>
                    <td class="s0"></td>
                </tr>
                <tr style="height: 32px" id="papua_tr">
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s0"></td>
                    <td class="s2" dir="ltr"><a target="_blank" href="https://emojipedia.org/large-red-circle/">ðŸ”´</a></td>
                    <td class="s0" id="papua_td_1"></td>
                    <td class="s0" id="papua_td_2"></td>
                    <td class="s0" id="papua_td_3"></td>
                    <td class="s0" id="papua_td_4"></td>
                    <td class="s0"></td>
                </tr>
                </tbody>
            </table>
        `);
    }

    refreshTable();

    updatePath(false);

    setInterval(() => {
        updatePath(true);
    }, 3000);

    function insertToTr(id, item) {
        let parenttbl = document.getElementById(id);
        let newel = document.createElement('td');
        newel.setAttribute('class', "s3");
        newel.setAttribute('dir', "ltr");
        newel.innerHTML = 'Bus ' + item.id || "Bus X";
        parenttbl.appendChild(newel);
    }

    function insertToTd(id, item) {
        let parenttbl = $('#'+id+'1');
        if (parenttbl.text() !== '') {
            parenttbl = $('#'+id+'2');
            if (parenttbl.text() !== '') {
                parenttbl = $('#'+id+'3');
                if (parenttbl.text() !== '') {
                    parenttbl = $('#'+id+'4');
                }
            }
        }

        parenttbl.html(item.id || 'Bus X');
        parenttbl.attr('class', "s3");
    }

    function updatePath(isRefetch) {
        $.ajax({
            url: "{{ route('getLocationBus') }}",
            method: 'GET',
            dataType: 'json',
            beforeSend: function() {

            },
            success: function (data) {
                console.log('data', data);

                if (isRefetch) {
                    refreshTable();
                }

                // REMAP DATA
                data.users.forEach((item, key) => {
                    // banten S21
                    if (item.beacon_id === 905) {
                        // insertToTr('banter_tr', item);
                        insertToTd('banten_td_', item);
                    }

                    // jabar R13
                    if (item.beacon_id === 896) {
                        // insertToTr('jabar_tr', item);
                        insertToTd('jabar_td_', item);
                    }

                    // jateng S34
                    if (item.beacon_id === 904) {
                        // insertToTr('jateng_tr', item);
                        insertToTd('jateng_td_', item);
                    }

                    // jatim S37
                    if (item.beacon_id === 906) {
                        // insertToTr('jatim_tr', item);
                        insertToTd('jatim_td_', item);
                    }

                    // bali R12
                    if (item.beacon_id === 897) {
                        // insertToTr('bali_tr', item);
                        insertToTd('bali_td_', item);
                    }

                    // kalbar S20
                    if (item.beacon_id === 901) {
                        // insertToTr('kalbar_tr', item);
                        insertToTd('kalbar_td_', item);
                    }

                    // sulsel S3
                    if (item.beacon_id === 903) {
                        // insertToTr('sulsel_tr', item);
                        insertToTd('sulsel_td_', item);
                    }

                    // papua S27
                    if (item.beacon_id === 902) {
                        // insertToTr('papua_tr', item);
                        insertToTd('papua_td_', item);
                    }
                })
            },
            error: function (xhr, status, error) {
                // console.error('Terjadi kesalahan:', error);
            },
        });
    }
</script>
@endsection
